<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
        <a-image id="image1" src="ASSETS/icon-128.png" position="-8 1.5 -11" width="2" height="3" 
                 animation="property:position; from:8 1.5 -11 ;to:-8 1.5 -11; dur:2000; loop:true; easing:linear; dir:alternate;"></a-image>
        <a-image id="image2" src="ASSETS/icon-128.png" position="7 5 -8" width="2" height="3"
                 animation="property:position; from:7 -5 -8; to:7 5 -8; dur:4000; easing:linear; loop:true; dir:alternate;"></a-image>
        <a-image id="image3" src="ASSETS/icon-128.png" position="-7 5 -8" width="2" height="3"
                 animation="property:position; from:-7 -5 -8; to:-7 5 -8; dur:4000; easing:linear; loop:true; dir:alternate;"></a-image>
        <a-sky src="ASSETS/sky.jpg"></a-sky>

  
        <a-text id="score" value="Score: 0" position="-1.5 6 -2" color="#FFF" width="6"></a-text>
      
        <a-text id="ballsLeft" value="Balls Left: 5" position="1.5 6 -2" color="#FFF" width="6"></a-text>
        
        <a-entity camera look-controls position="0 2 5"></a-entity>
    </a-scene>
    
    <script>
      let score = 0;
      let ballsLeft = 5;

      const ballPool = [];
      const poolSize = 5; 

      for (let i = 0; i < poolSize; i++) {
        const ball = document.createElement('a-sphere');
        ball.setAttribute('radius', '0.2');
        ball.setAttribute('color', '#6c75e0');
        ball.setAttribute('visible', 'false');
        ball.setAttribute('dynamic-body', '');
        ballPool.push(ball);
        document.querySelector('a-scene').appendChild(ball);
      }

      document.addEventListener('keydown', function(event) {
        if (event.code === 'Space' && ballsLeft > 0) {
          shootBall();
        }
      });

      function getAvailableBall() {
        for (const ball of ballPool) {
          if (!ball.getAttribute('visible')) {
            return ball;
          }
        }
        return null;
      }

      function shootBall() {
        const ball = getAvailableBall();
        if (!ball) {
          console.log('No available balls in the pool.');
          return;
        }
        
        ball.setAttribute('position', '0 1 5');
        ball.setAttribute('visible', 'true');
        
        const camera = document.querySelector('[camera]');
        const direction = new THREE.Vector3(0, 0, -1);
        direction.applyQuaternion(camera.object3D.quaternion);

        ballsLeft--;
        updateBallsLeft();

        function moveBall() {
          const currentPosition = new THREE.Vector3();
          ball.object3D.getWorldPosition(currentPosition);
          
          currentPosition.add(direction.clone().multiplyScalar(0.4));
          ball.setAttribute('position', currentPosition);
          
          // Check for collisions
          const raycaster = new THREE.Raycaster(currentPosition, direction);
          const intersects = raycaster.intersectObjects(document.querySelector('a-scene').object3D.children, true);
          
          if (intersects.length > 0) {
            const hitObject = intersects[0].object.el;
            if (hitObject && hitObject.tagName === 'A-IMAGE') {
              console.log('Hit image:', hitObject.id);
              hitObject.parentNode.removeChild(hitObject);
              ball.setAttribute('visible', 'false');
              updateScore(); // Update the score
              return;
            }
          }
          
          // Remove ball if it goes too far
          if (currentPosition.length() > 50) {
            ball.setAttribute('visible', 'false');
            return;
          }
          
          requestAnimationFrame(moveBall);
        }
        
        requestAnimationFrame(moveBall);
      }

      function updateScore() {
        score++;
        const scoreText = document.getElementById('score');
        scoreText.setAttribute('value', 'Score: ' + score);
        if(score == 3){
          scoreText.setAttribute('value','You Won');
        } else if(poolSize == 0){
          scoreText.setAttribute('value', "You lost")
        }
      }

      function updateBallsLeft() {
        const ballsLeftText = document.getElementById('ballsLeft');
        ballsLeftText.setAttribute('value', 'Balls Left: ' + ballsLeft);
      }

      // Initialize counters
      updateBallsLeft();
    </script>
  </body>
</html>
 